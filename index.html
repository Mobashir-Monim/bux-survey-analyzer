<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css">
    <title>buX Survey Analyzer</title>
</head>
<body>
    <div class="container">
        <div class="row my-4 align-items-center">
            <div class="col-4 col-sm-2">
                <img src="img/nav-inv.png" alt="buX-logo" class="img-fluid">
            </div>
            <div class="col-8 col-sm">
                <h2 class="border-bottom d-none d-sm-block">buX Survey Analyzer</h2>
                <h5 class="border-bottom d-block d-sm-none">buX Survey Analyzer</h5>
            </div>
        </div>
        <div class="row mb-4">
            <div class="col-md-12">
                <input type="file" name="survey-response" id="survey-response" class="form-control mb-1" accept=".xlsx, .xls">
                <label for="survey-response" class="col-form-label text-right col-12 pt-0">Survey Response</label>
                <h4 class="border-bottom mb-0 mt-3">Survey Questions</h4>
                <div id="survey-response-out"></div>
            </div>
        </div>
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="list-group bg-dark" id="list-tab" role="tablist" style="border-bottom-left-radius: 0px !important; border-bottom-right-radius: 0px !important; border-top-right-radius: .25rem !important;">
                    <a class="list-group-item list-group-item-action active" id="list-year-wise-list" data-toggle="list" href="#year-wise" role="tab" aria-controls="year-wise" style="border-bottom-right-radius: 0px !important;">Year-wise</a>
                    <a class="list-group-item list-group-item-action" id="list-course-wise-list" data-toggle="list" href="#course-wise" role="tab" aria-controls="course-wise">Load-wise</a>
                    <a class="list-group-item list-group-item-action" id="list-dept-wise-list" data-toggle="list" href="#dept-wise" role="tab" aria-controls="dept-wise" style="border-bottom-left-radius: 0px !important; border-bottom-right-radius: 0px !important; border-top-right-radius: .25rem !important;">Dept-wise</a>
                </div>
                <div class="tab-content bg-dark" id="nav-tabContent">
                    <div class="tab-pane fade show active" id="year-wise" role="tabpanel" aria-labelledby="list-year-wise-list">
                        <div class="accordion" id="yearly-segregation">
                            <div class="card bg-dark">
                                <div class="card-header btn btn-dark" id="yq1">
                                    <h2 class="mb-0">
                                    <button class="btn btn-block text-left text-white" type="button" data-toggle="collapse" data-target="#yd1" aria-expanded="true" aria-controls="yd1">
                                        buX is a better approach?
                                    </button>
                                    </h2>
                                </div>
                            
                                <div id="yd1" class="collapse show" aria-labelledby="yq1" data-parent="#yearly-segregation">
                                    <div class="card-body">
                                        <canvas id="yd1c" class="hidden" width="100%" height="70%"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="card bg-dark">
                                <div class="card-header btn btn-dark" id="yq2">
                                    <h2 class="mb-0">
                                    <button class="btn text-white btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#yd2" aria-expanded="false" aria-controls="yd2">
                                        buX account email
                                    </button>
                                    </h2>
                                </div>
                                <div id="yd2" class="collapse" aria-labelledby="yq2" data-parent="#yearly-segregation">
                                    <div class="card-body">
                                        <canvas id="yd2c" class="hidden" width="100%" height="70%"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="course-wise" role="tabpanel" aria-labelledby="list-course-wise-list">
                        <div class="accordion" id="load-segregation">
                            <div class="card bg-dark">
                                <div class="card-header btn btn-dark" id="lq1">
                                    <h2 class="mb-0">
                                    <button class="btn btn-block text-left text-white" type="button" data-toggle="collapse" data-target="#ld1" aria-expanded="true" aria-controls="ld1">
                                        buX is a better approach?
                                    </button>
                                    </h2>
                                </div>
                            
                                <div id="ld1" class="collapse show" aria-labelledby="lq1" data-parent="#load-segregation">
                                    <div class="card-body">
                                        <canvas id="ld1c" class="hidden" width="100%" height="70%"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="card bg-dark">
                                <div class="card-header btn btn-dark" id="lq2">
                                    <h2 class="mb-0">
                                    <button class="btn text-white btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#ld2" aria-expanded="false" aria-controls="ld2">
                                        buX account email
                                    </button>
                                    </h2>
                                </div>
                                <div id="ld2" class="collapse" aria-labelledby="lq2" data-parent="#load-segregation">
                                    <div class="card-body">
                                        <canvas id="ld2c" class="hidden" width="100%" height="70%"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="dept-wise" role="tabpanel" aria-labelledby="list-dept-wise-list">
                        <div class="accordion" id="dept-segregation">
                            <div class="card bg-dark">
                                <div class="card-header btn btn-dark" id="dq1">
                                    <h2 class="mb-0">
                                    <button class="btn btn-block text-left text-white" type="button" data-toggle="collapse" data-target="#dd1" aria-expanded="true" aria-controls="dd1">
                                        buX is a better approach?
                                    </button>
                                    </h2>
                                </div>
                            
                                <div id="dd1" class="collapse show" aria-labelledby="dq1" data-parent="#dept-segregation">
                                    <div class="card-body">
                                        <canvas id="dd1c" class="hidden" width="100%" height="70%"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="card bg-dark">
                                <div class="card-header btn btn-dark" id="dq2">
                                    <h2 class="mb-0">
                                    <button class="btn text-white btn-block text-left collapsed" type="button" data-toggle="collapse" data-target="#dd2" aria-expanded="false" aria-controls="dd2">
                                        buX account email
                                    </button>
                                    </h2>
                                </div>
                                <div id="dd2" class="collapse" aria-labelledby="dq2" data-parent="#dept-segregation">
                                    <div class="card-body">
                                        <canvas id="dd2c" class="hidden" width="100%" height="70%"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.0/jszip.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.0/xlsx.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
    <script type="text/javascript">
        let fileData = null;
        let yearlySegregation = [], yClasses = ['Freshman', 'Sophmore', 'Junior', 'Senior', 'Advanced Senior'];
        let loadSegregation = [], lClasses = ['1 Course', '2 Courses', '3 Courses', '4 Courses', '5 Courses', '>= 6 Courses'];
        let deptSegregation = [], dClasses = ['CSE', 'BBS', 'MNS', 'EEE', 'ENH', 'Architecture', 'Pharmacy', 'Law', 'BIL', 'BIGD', 'CPJ', 'JPGSPH', 'BIED', 'C3ER'];
        let d1c = [document.getElementById('yd1c').getContext('2d'), document.getElementById('ld1c').getContext('2d'), document.getElementById('dd1c').getContext('2d')];

        $("input#survey-response").change(function () {
            readFile('survey-response');
        });

        function readFile(file) {
            let fileInput = document.getElementById(file);
            let out = document.getElementById(file + '-out');
            out.classList.add('text-center');
            out.innerHTML = '<div class="mt-2 spinner-border text-light" role="status"><span class="sr-only">Loading...</span></div>';
            setTimeout(() => {
                let reader = new FileReader();

                reader.onload = function () {
                    exelToJSON(reader.result, out);
                };

                reader.readAsBinaryString(fileInput.files[0]);
            }, 100);
        };

        function exelToJSON(data, out) {
            let cfb = XLSX.read(data, {type: 'binary'});
                
            cfb.SheetNames.forEach(function(sheetName) {   
                let oJS = XLS.utils.sheet_to_json(cfb.Sheets[sheetName]);
                let result = [];
                let headers = Object.keys(oJS[0]);
                let table = '<table class="table table-hover table-dark text-white pane"><thead><tr><th scope="col">Headers</th></tr></thead><tbody>';

                headers.forEach(element => {
                    table += '<tr><td>' + element + '</td></tr>';
                });

                table += '</tbody></table>';

                for (let index = 0; index < oJS.length; index++) {
                    let imm = {};

                    headers.forEach(key => {
                        imm[key] = oJS[index][key] != undefined ? oJS[index][key].toString() : oJS[index][key];
                    });

                    result.push(imm);
                }

                fileData = result;
                out.innerHTML = table;
                out.classList.remove('text-center');
                segregate();
            });
        }

        function segregate() {
            yearlySegregation.push(fileData.filter(obj => obj["Which semester are you in"] <= 3 ));
            yearlySegregation.push(fileData.filter(obj => obj["Which semester are you in"] > 3 && obj["Which semester are you in"] <= 6 ));
            yearlySegregation.push(fileData.filter(obj => obj["Which semester are you in"] > 6 && obj["Which semester are you in"] <= 9 ));
            yearlySegregation.push(fileData.filter(obj => obj["Which semester are you in"] > 9 && obj["Which semester are you in"] <= 12 ));
            yearlySegregation.push(fileData.filter(obj => obj["Which semester are you in"] > 12 ));

            loadSegregation.push(fileData.filter(obj => obj["How many courses are you taking?"] == 1));
            loadSegregation.push(fileData.filter(obj => obj["How many courses are you taking?"] == 2));
            loadSegregation.push(fileData.filter(obj => obj["How many courses are you taking?"] == 3));
            loadSegregation.push(fileData.filter(obj => obj["How many courses are you taking?"] == 4));
            loadSegregation.push(fileData.filter(obj => obj["How many courses are you taking?"] == 5));
            loadSegregation.push(fileData.filter(obj => obj["How many courses are you taking?"] != 1 || obj["How many courses are you taking?"] != 2|| obj["How many courses are you taking?"] != 3|| obj["How many courses are you taking?"] != 4|| obj["How many courses are you taking?"] != 5));

            deptSegregation.push(fileData.filter(obj => obj["Department/School/Institute/Center"] == "CSE"));
            deptSegregation.push(fileData.filter(obj => obj["Department/School/Institute/Center"] == "BBS"));
            deptSegregation.push(fileData.filter(obj => obj["Department/School/Institute/Center"] == "MNS"));
            deptSegregation.push(fileData.filter(obj => obj["Department/School/Institute/Center"] == "EEE"));
            deptSegregation.push(fileData.filter(obj => obj["Department/School/Institute/Center"] == "ENH"));
            deptSegregation.push(fileData.filter(obj => obj["Department/School/Institute/Center"] == "Architecture"));
            deptSegregation.push(fileData.filter(obj => obj["Department/School/Institute/Center"] == "Pharmacy"));
            deptSegregation.push(fileData.filter(obj => obj["Department/School/Institute/Center"] == "Law"));
            deptSegregation.push(fileData.filter(obj => obj["Department/School/Institute/Center"] == "BIL"));
            deptSegregation.push(fileData.filter(obj => obj["Department/School/Institute/Center"] == "BIGD"));
            deptSegregation.push(fileData.filter(obj => obj["Department/School/Institute/Center"] == "CPJ"));
            deptSegregation.push(fileData.filter(obj => obj["Department/School/Institute/Center"] == "JPGSPH"));
            deptSegregation.push(fileData.filter(obj => obj["Department/School/Institute/Center"] == "BIED"));
            deptSegregation.push(fileData.filter(obj => obj["Department/School/Institute/Center"] == "C3ER"));

            d1(yearlySegregation, d1c[0], yClasses); d1(loadSegregation, d1c[1], lClasses); d1(deptSegregation, d1c[2], dClasses);
        }

        function d1(seg, canv, seglabels) {
            let dist = [], classes = ["Strongly agree", "Agree", "Neutral", "Disagree", "Strongly disagree"];
            
            classes.forEach(c => {
                let imm = [];
                seg.forEach(part => {
                    imm.push(part.filter(obj => obj["Suppose someone says buX an improvement on Spring 2020's online learning approach. How would you react?"] == c).length);});
                dist.push(imm);
            });

            new Chart(canv, {
                type: 'horizontalBar',
                data: {
                    labels: seglabels,
                    datasets: [{
                        label: 'Strongly agree', data: dist[0], backgroundColor: 'rgba(75, 192, 192, 0.2)', borderColor: 'rgba(75, 192, 192, 1)', borderWidth: 1},{
                        label: 'Agree', data: dist[1], backgroundColor: 'rgba(54, 162, 235, 0.2)', borderColor: 'rgba(54, 162, 235, 1)', borderWidth: 1},{
                        label: 'Neutral', data: dist[2], backgroundColor: 'rgba(255, 206, 86, 0.2)', borderColor: 'rgba(255, 206, 86, 1)', borderWidth: 1},{
                        label: 'Disagree', data: dist[3], backgroundColor: 'rgba(255, 159, 64, 0.2)', borderColor: 'rgba(255, 159, 64, 1)', borderWidth: 1},{
                        label: 'Strongly disagree', data: dist[4], backgroundColor: 'rgba(255, 99, 132, 0.2)', borderColor: 'rgba(255, 99, 132, 1)', borderWidth: 1}]
                },
            });
        }

    </script>
</body>
</html>